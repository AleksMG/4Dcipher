<!DOCTYPE html>
<html>
<head>
    <title>Трифорд-4D Шифратор</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        textarea, input, button {
            padding: 10px;
            font-size: 16px;
        }
        button {
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        .output {
            border: 1px solid #ddd;
            padding: 15px;
            min-height: 100px;
            background-color: #f9f9f9;
        }
        .coord-system {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9e9e9;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Трифорд-4D Шифратор</h1>
    
    <div class="container">
        <div>
            <h3>Исходное сообщение:</h3>
            <textarea id="message" rows="4" cols="50" placeholder="Введите сообщение (только A-Z)"></textarea>
        </div>
        
        <div>
            <h3>Ключ (3 числа через запятую):</h3>
            <input type="text" id="coordKey" value="5,7,2" placeholder="Например: 1,2,3">
        </div>
        
        <div>
            <h3>Символьный ключ (для 4-й координаты):</h3>
            <input type="text" id="charKey" value="SECRET" placeholder="Например: KEY">
        </div>
        
        <div>
            <button onclick="encrypt()">Зашифровать</button>
            <button onclick="decrypt()">Дешифровать</button>
        </div>
        
        <div>
            <h3>Результат:</h3>
            <div id="result" class="output"></div>
        </div>
        
        <div class="coord-system">
            <h3>Система координат:</h3>
            <p>Каждая буква представляется как (строка, столбец, слой, символ):</p>
            <p>1. Первые 3 числа вычисляются через позицию буквы в алфавите и основной ключ</p>
            <p>2. 4-я координата берётся из символьного ключа по кругу</p>
        </div>
    </div>

    <script>
        const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        
        // Преобразование буквы в 3D координаты
        function charTo3D(char, key) {
            const index = alphabet.indexOf(char);
            if (index === -1) return null;
            
            const row = Math.floor(index / 9);
            const col = Math.floor((index % 9) / 3);
            const layer = index % 3;
            
            // Применяем ключ
            return [
                (row + key[0]) % 3,
                (col + key[1]) % 3,
                (layer + key[2]) % 3
            ];
        }
        
        // Преобразование 3D координат в букву
        function coordsToChar(coords, key) {
            const [row, col, layer] = coords;
            
            // Отменяем ключ
            const origRow = (row - key[0] + 3) % 3;
            const origCol = (col - key[1] + 3) % 3;
            const origLayer = (layer - key[2] + 3) % 3;
            
            const index = origRow * 9 + origCol * 3 + origLayer;
            return alphabet[index];
        }
        
        // Шифрование
        function encrypt() {
            const message = document.getElementById('message').value.toUpperCase().replace(/[^A-Z]/g, '');
            const coordKey = document.getElementById('coordKey').value.split(',').map(Number);
            const charKey = document.getElementById('charKey').value.toUpperCase().replace(/[^A-Z]/g, '') || 'A';
            
            if (coordKey.length !== 3) {
                alert('Ключ должен содержать 3 числа через запятую!');
                return;
            }
            
            let result = [];
            for (let i = 0; i < message.length; i++) {
                const char = message[i];
                const coords = charTo3D(char, coordKey);
                if (!coords) continue;
                
                // Берём символ для 4-й координаты из ключа по кругу
                const k4Char = charKey[i % charKey.length];
                result.push(`(${coords[0]},${coords[1]},${coords[2]},'${k4Char}')`);
            }
            
            document.getElementById('result').innerHTML = result.join(' ');
        }
        
        // Дешифрование
        function decrypt() {
            const input = document.getElementById('message').value.trim();
            const coordKey = document.getElementById('coordKey').value.split(',').map(Number);
            const charKey = document.getElementById('charKey').value.toUpperCase().replace(/[^A-Z]/g, '') || 'A';
            
            if (coordKey.length !== 3) {
                alert('Ключ должен содержать 3 числа через запятую!');
                return;
            }
            
            // Парсим координаты из строки вида (1,2,3,'A')
            const coordsRegex = /\((\d+),(\d+),(\d+),'([A-Z])'\)/g;
            let match;
            const allCoords = [];
            
            while ((match = coordsRegex.exec(input)) !== null) {
                allCoords.push({
                    coords: [parseInt(match[1]), parseInt(match[2]), parseInt(match[3])],
                    k4Char: match[4]
                });
            }
            
            if (allCoords.length === 0) {
                alert('Не найдены координаты для дешифровки!');
                return;
            }
            
            // Проверяем 4-ю координату
            let decrypted = '';
            let keyValid = true;
            
            for (let i = 0; i < allCoords.length; i++) {
                const expectedChar = charKey[i % charKey.length];
                if (allCoords[i].k4Char !== expectedChar) {
                    keyValid = false;
                }
                
                const char = coordsToChar(allCoords[i].coords, coordKey);
                decrypted += char;
            }
            
            if (!keyValid) {
                decrypted += ' (Внимание: 4-я координата не совпадает с ключом!)';
            }
            
            document.getElementById('result').innerHTML = decrypted;
        }
    </script>
</body>
</html>
