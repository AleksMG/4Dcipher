<!DOCTYPE html>
<html>
<head>
    <title>Аномальный Алгебраический Шифратор</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        .output {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f8f8;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Аномальный Алгебраический Шифратор</h1>
        <p>Шифрование на основе неассоциативной октонионной алгебры</p>
        
        <div>
            <h3>Исходный текст:</h3>
            <textarea id="plaintext" placeholder="Введите текст для шифрования">HELLO</textarea>
        </div>
        
        <div>
            <h3>Ключ (8 чисел через запятую):</h3>
            <input type="text" id="key" placeholder="Например: 1,-1,0,0.5,2,-0.5,1,0" style="width:100%" value="1,2,3,4,5,6,7,8">
        </div>
        
        <button onclick="encrypt()">Зашифровать</button>
        <button onclick="decrypt()">Дешифровать</button>
        
        <div class="output">
            <h3>Результат:</h3>
            <textarea id="result" readonly></textarea>
        </div>
    </div>

    <script>
        // Октонионная алгебра (неассоциативная)
        class Octonion {
            constructor(e0, e1, e2, e3, e4, e5, e6, e7) {
                this.coeff = [e0, e1, e2, e3, e4, e5, e6, e7];
            }
            
            // Умножение октонионов (неассоциативное)
            multiply(o) {
                const a = this.coeff;
                const b = o.coeff;
                return new Octonion(
                    a[0]*b[0] - a[1]*b[1] - a[2]*b[2] - a[3]*b[3] - a[4]*b[4] - a[5]*b[5] - a[6]*b[6] - a[7]*b[7],
                    a[0]*b[1] + a[1]*b[0] + a[2]*b[4] + a[3]*b[7] - a[4]*b[2] + a[5]*b[6] - a[6]*b[5] - a[7]*b[3],
                    a[0]*b[2] - a[1]*b[4] + a[2]*b[0] + a[3]*b[5] + a[4]*b[1] - a[5]*b[3] + a[6]*b[7] - a[7]*b[6],
                    a[0]*b[3] - a[1]*b[7] - a[2]*b[5] + a[3]*b[0] + a[4]*b[6] + a[5]*b[2] - a[6]*b[4] + a[7]*b[1],
                    a[0]*b[4] + a[1]*b[2] - a[2]*b[1] - a[3]*b[6] + a[4]*b[0] + a[5]*b[7] + a[6]*b[3] - a[7]*b[5],
                    a[0]*b[5] - a[1]*b[6] + a[2]*b[3] - a[3]*b[2] - a[4]*b[7] + a[5]*b[0] + a[6]*b[1] + a[7]*b[4],
                    a[0]*b[6] + a[1]*b[5] - a[2]*b[7] + a[3]*b[4] - a[4]*b[3] - a[5]*b[1] + a[6]*b[0] + a[7]*b[2],
                    a[0]*b[7] + a[1]*b[3] + a[2]*b[6] - a[3]*b[1] + a[4]*b[5] - a[5]*b[4] - a[6]*b[2] + a[7]*b[0]
                );
            }
            
            // Обратный элемент (для дешифрования)
            inverse() {
                const norm = this.coeff.reduce((sum, x) => sum + x*x, 0);
                if (norm === 0) throw new Error("Невозможно инвертировать нулевой октонион");
                return new Octonion(
                    this.coeff[0]/norm,
                    -this.coeff[1]/norm,
                    -this.coeff[2]/norm,
                    -this.coeff[3]/norm,
                    -this.coeff[4]/norm,
                    -this.coeff[5]/norm,
                    -this.coeff[6]/norm,
                    -this.coeff[7]/norm
                );
            }
            
            // Сериализация в строку
            toString() {
                return this.coeff.map(x => x.toFixed(6)).join('|');
            }
            
            // Десериализация из строки
            static fromString(str) {
                const parts = str.split('|').map(Number);
                if (parts.length !== 8 || parts.some(isNaN)) {
                    throw new Error("Неверный формат октониона");
                }
                return new Octonion(...parts);
            }
        }

        // Преобразование текста в октонионы
        function textToOctonions(text) {
            const octonions = [];
            for (let i = 0; i < text.length; i += 4) {
                const c1 = text.charCodeAt(i) || 0;
                const c2 = text.charCodeAt(i+1) || 0;
                const c3 = text.charCodeAt(i+2) || 0;
                const c4 = text.charCodeAt(i+3) || 0;
                octonions.push(new Octonion(c1, c2, c3, c4, 0, 0, 0, 0));
            }
            return octonions;
        }

        // Преобразование октонионов в текст
        function octonionsToText(octonions) {
            let text = '';
            for (const o of octonions) {
                const c1 = Math.round(o.coeff[0]);
                const c2 = Math.round(o.coeff[1]);
                const c3 = Math.round(o.coeff[2]);
                const c4 = Math.round(o.coeff[3]);
                text += String.fromCharCode(c1) + String.fromCharCode(c2) + 
                        String.fromCharCode(c3) + String.fromCharCode(c4);
            }
            return text.replace(/\x00/g, '');
        }

        // Шифрование
        function encrypt() {
            const text = document.getElementById('plaintext').value;
            const keyStr = document.getElementById('key').value;
            
            if (!keyStr) {
                alert("Введите ключ (8 чисел через запятую)");
                return;
            }
            
            try {
                const keyParts = keyStr.split(',').map(Number);
                if (keyParts.length !== 8 || keyParts.some(isNaN)) {
                    throw new Error("Ключ должен содержать 8 чисел");
                }
                
                const key = new Octonion(...keyParts);
                const octonions = textToOctonions(text);
                
                // Шифрование: умножение каждого октониона на ключ
                const encrypted = octonions.map(o => o.multiply(key));
                
                // Сериализация результата
                const result = encrypted.map(o => o.toString()).join('\n');
                
                document.getElementById('result').value = result;
            } catch (e) {
                alert("Ошибка при шифровании: " + e.message);
            }
        }

        // Дешифрование
        function decrypt() {
            const ciphertext = document.getElementById('plaintext').value;
            const keyStr = document.getElementById('key').value;
            
            if (!keyStr) {
                alert("Введите ключ (8 чисел через запятую)");
                return;
            }
            
            try {
                const keyParts = keyStr.split(',').map(Number);
                if (keyParts.length !== 8 || keyParts.some(isNaN)) {
                    throw new Error("Ключ должен содержать 8 чисел");
                }
                
                const key = new Octonion(...keyParts).inverse();
                const octonionStrs = ciphertext.split('\n').filter(s => s.trim() !== '');
                
                // Восстановление октонионов
                const octonions = octonionStrs.map(s => Octonion.fromString(s));
                
                // Дешифрование: умножение на обратный ключ
                const decrypted = octonions.map(o => o.multiply(key));
                
                document.getElementById('result').value = octonionsToText(decrypted);
            } catch (e) {
                alert("Ошибка при дешифровании: " + e.message);
            }
        }
    </script>
</body>
</html>
