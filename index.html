<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trifid Cipher (3×4×3 Cube)</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --error-color: #e74c3c;
            --highlight-color: #fffacd;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background-color);
        }
        
        h1, h2 {
            color: var(--primary-color);
            text-align: center;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        
        .control-panel {
            flex: 1;
            min-width: 400px;
            background: var(--card-color);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .visualization {
            flex: 1;
            min-width: 400px;
            background: var(--card-color);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        label {
            display: block;
            margin-top: 20px;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-color);
        }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 14px 20px;
            margin-top: 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
        }
        
        .cube-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px 0;
        }
        
        .cube-layer {
            border: 2px solid var(--primary-color);
            border-radius: 5px;
            padding: 10px;
            background-color: #f5f5f5;
        }
        
        .layer-title {
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .cube-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        
        .cube-cell {
            border: 1px solid #ddd;
            padding: 15px 0;
            text-align: center;
            background-color: white;
            font-weight: bold;
            position: relative;
        }
        
        .coordinates {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 10px;
            color: #777;
        }
        
        .highlight {
            background-color: var(--highlight-color);
            animation: highlight 1s;
        }
        
        @keyframes highlight {
            0% { background-color: var(--highlight-color); }
            100% { background-color: white; }
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #edf5fc;
            border-radius: 6px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .error {
            color: var(--error-color);
            margin-top: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #eee;
            border: none;
            flex: 1;
            text-align: center;
        }
        
        .tab.active {
            background: var(--secondary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>Trifid Cipher (3×4×3 Cube)</h1>
    
    <div class="container">
        <div class="control-panel">
            <h2>Cipher Settings</h2>
            
            <label for="alphabet">Alphabet (36 characters required):</label>
            <textarea id="alphabet">ZYXWVUTSRQPONMLKJIHGFEDCBA×+ꓘꓥꓭꓷ⊕ΞΔ⌖</textarea>
            
            <label for="key">Encryption Key:</label>
            <input type="text" id="key" value="SECRET">
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('encrypt')">Encrypt</button>
                <button class="tab" onclick="switchTab('decrypt')">Decrypt</button>
            </div>
            
            <div id="encrypt-tab" class="tab-content active">
                <label for="plaintext">Plaintext:</label>
                <textarea id="plaintext" placeholder="Text to encrypt"></textarea>
                <button id="encrypt-btn">Encrypt</button>
            </div>
            
            <div id="decrypt-tab" class="tab-content">
                <label for="ciphertext">Ciphertext:</label>
                <textarea id="ciphertext" placeholder="Text to decrypt"></textarea>
                <button id="decrypt-btn">Decrypt</button>
            </div>
            
            <div id="error" class="error"></div>
        </div>
        
        <div class="visualization">
            <h2>3×4×3 Cube Visualization</h2>
            
            <div class="cube-display" id="cube-display">
                <!-- Cube layers will be generated here -->
            </div>
            
            <div class="result">
                <h3>Result:</h3>
                <div id="result-text"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Constants
        const LAYERS = 3;
        const ROWS = 4;
        const COLS = 3;
        const TOTAL_CELLS = LAYERS * ROWS * COLS;
        
        // DOM elements
        const alphabetInput = document.getElementById('alphabet');
        const keyInput = document.getElementById('key');
        const plaintextInput = document.getElementById('plaintext');
        const ciphertextInput = document.getElementById('ciphertext');
        const encryptBtn = document.getElementById('encrypt-btn');
        const decryptBtn = document.getElementById('decrypt-btn');
        const resultText = document.getElementById('result-text');
        const errorDiv = document.getElementById('error');
        const cubeDisplay = document.getElementById('cube-display');
        
        // Initialize cipher
        let cube = [];
        let charToCoords = {};
        let coordsToChar = {};
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        function initCube() {
            cubeDisplay.innerHTML = '';
            charToCoords = {};
            coordsToChar = {};
            
            const alphabet = alphabetInput.value;
            if (alphabet.length < TOTAL_CELLS) {
                showError(`Alphabet must contain at least ${TOTAL_CELLS} characters. Currently has ${alphabet.length}.`);
                return false;
            }
            
            // Create 3 layers of 4x3 grids
            for (let layer = 0; layer < LAYERS; layer++) {
                const layerDiv = document.createElement('div');
                layerDiv.className = 'cube-layer';
                
                const title = document.createElement('div');
                title.className = 'layer-title';
                title.textContent = `Layer ${layer + 1}`;
                layerDiv.appendChild(title);
                
                const grid = document.createElement('div');
                grid.className = 'cube-grid';
                
                for (let row = 0; row < ROWS; row++) {
                    for (let col = 0; col < COLS; col++) {
                        const index = (layer * ROWS * COLS) + (row * COLS) + col;
                        const char = alphabet[index] || ' ';
                        
                        const cell = document.createElement('div');
                        cell.className = 'cube-cell';
                        cell.textContent = char;
                        cell.id = `cell-${layer}-${row}-${col}`;
                        
                        const coords = document.createElement('div');
                        coords.className = 'coordinates';
                        coords.textContent = `${layer+1}.${row+1}.${col+1}`;
                        
                        cell.appendChild(coords);
                        grid.appendChild(cell);
                        
                        // Store coordinates
                        charToCoords[char] = { layer, row, col };
                        coordsToChar[`${layer},${row},${col}`] = char;
                    }
                }
                
                layerDiv.appendChild(grid);
                cubeDisplay.appendChild(layerDiv);
            }
            
            hideError();
            return true;
        }
        
        function encrypt() {
            if (!initCube()) return;
            
            const plaintext = plaintextInput.value.toUpperCase();
            const key = keyInput.value.toUpperCase();
            
            if (!plaintext) {
                showError('Enter text to encrypt');
                return;
            }
            
            let result = '';
            let keyIndex = 0;
            
            for (let i = 0; i < plaintext.length; i++) {
                const char = plaintext[i];
                const keyChar = key[keyIndex % key.length];
                
                if (!(char in charToCoords)) {
                    result += char;
                    continue;
                }
                
                if (!(keyChar in charToCoords)) {
                    showError(`Key character '${keyChar}' not in alphabet`);
                    return;
                }
                
                // Get coordinates
                const charCoords = charToCoords[char];
                const keyCoords = charToCoords[keyChar];
                
                // Calculate new coordinates
                const newLayer = (charCoords.layer + keyCoords.layer) % LAYERS;
                const newRow = (charCoords.row + keyCoords.row) % ROWS;
                const newCol = (charCoords.col + keyCoords.col) % COLS;
                
                // Get encrypted character
                const encryptedChar = coordsToChar[`${newLayer},${newRow},${newCol}`];
                result += encryptedChar;
                
                // Highlight animation
                highlightCell(charCoords.layer, charCoords.row, charCoords.col);
                highlightCell(keyCoords.layer, keyCoords.row, keyCoords.col);
                highlightCell(newLayer, newRow, newCol);
                
                keyIndex++;
            }
            
            resultText.textContent = result;
            ciphertextInput.value = result;
        }
        
        function decrypt() {
            if (!initCube()) return;
            
            const ciphertext = ciphertextInput.value.toUpperCase();
            const key = keyInput.value.toUpperCase();
            
            if (!ciphertext) {
                showError('Enter text to decrypt');
                return;
            }
            
            let result = '';
            let keyIndex = 0;
            
            for (let i = 0; i < ciphertext.length; i++) {
                const char = ciphertext[i];
                const keyChar = key[keyIndex % key.length];
                
                if (!(char in charToCoords)) {
                    result += char;
                    continue;
                }
                
                if (!(keyChar in charToCoords)) {
                    showError(`Key character '${keyChar}' not in alphabet`);
                    return;
                }
                
                // Get coordinates
                const charCoords = charToCoords[char];
                const keyCoords = charToCoords[keyChar];
                
                // Calculate original coordinates
                const newLayer = (charCoords.layer - keyCoords.layer + LAYERS) % LAYERS;
                const newRow = (charCoords.row - keyCoords.row + ROWS) % ROWS;
                const newCol = (charCoords.col - keyCoords.col + COLS) % COLS;
                
                // Get decrypted character
                const decryptedChar = coordsToChar[`${newLayer},${newRow},${newCol}`];
                result += decryptedChar;
                
                // Highlight animation
                highlightCell(charCoords.layer, charCoords.row, charCoords.col);
                highlightCell(keyCoords.layer, keyCoords.row, keyCoords.col);
                highlightCell(newLayer, newRow, newCol);
                
                keyIndex++;
            }
            
            resultText.textContent = result;
            plaintextInput.value = result;
        }
        
        function highlightCell(layer, row, col) {
            const cell = document.getElementById(`cell-${layer}-${row}-${col}`);
            if (cell) {
                cell.classList.add('highlight');
                setTimeout(() => {
                    cell.classList.remove('highlight');
                }, 1000);
            }
        }
        
        function showError(message) {
            errorDiv.textContent = message;
        }
        
        function hideError() {
            errorDiv.textContent = '';
        }
        
        // Event listeners
        encryptBtn.addEventListener('click', encrypt);
        decryptBtn.addEventListener('click', decrypt);
        
        // Initialize
        initCube();
    </script>
</body>
</html>
